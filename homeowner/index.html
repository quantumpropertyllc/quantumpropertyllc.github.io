<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>NC Property Hub</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #f2f2f7; --card: #ffffff; --text: #1c1c1e; --sub: #8e8e93;
      --primary: #007aff; --accent: #5856d6; --border: rgba(0,0,0,0.1);
      --input-bg: #f2f2f7; --success: #34c759; --warning: #ff9500;
      --btn-link-bg: rgba(0,122,255,0.1); --btn-link-text: #007aff;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #000000; --card: #1c1c1e; --text: #ffffff; --sub: #8e8e93;
        --primary: #0a84ff; --input-bg: #2c2c2e; --btn-link-bg: rgba(10,132,255,0.2);
      }
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; font-family: -apple-system, sans-serif; 
      background: var(--bg); color: var(--text); padding-bottom: 30px;
    }
    .container { max-width: 800px; margin: auto; padding: 0 16px; }

    /* Sticky Header Controls */
    .header-controls { 
      position: sticky; top: 0; background: var(--bg); 
      padding: 15px 0 10px; z-index: 100;
    }
    .controls-grid { display: flex; flex-direction: column; gap: 8px; }
    #searchInput { 
      padding: 12px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--card); font-size: 16px; outline: none;
    }
    #categoryFilter { 
      padding: 12px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--card); color: var(--text); font-size: 14px;
    }

    /* Cards */
    .card { background: var(--card); border-radius: 14px; padding: 18px; margin-bottom: 15px; box-shadow: 0 1px 3px var(--border); }
    h3 { margin: 0 0 15px 0; font-size: 1.1rem; border-left: 4px solid var(--primary); padding-left: 10px; }
    .tag { font-size: 0.7rem; background: var(--primary); color: white; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
    
    .info-list { display: flex; flex-direction: column; gap: 12px; }
    .info-item { border-bottom: 1px solid var(--border); padding-bottom: 10px; }
    .info-item:last-child { border-bottom: none; padding-bottom: 0; }
    .info-label { display: block; font-size: 0.75rem; color: var(--sub); font-weight: 600; margin-bottom: 4px; }
    .info-content { font-size: 0.95rem; line-height: 1.5; }
    .phone-link { color: var(--primary); text-decoration: none; font-weight: 600; }

    /* Calc & Tables */
    .calc-form { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .calc-group { display: flex; flex-direction: column; }
    .calc-group.full { grid-column: span 2; }
    .calc-group label { font-size: 0.75rem; color: var(--sub); margin-bottom: 4px; }
    .calc-group input { 
      padding: 10px; border-radius: 8px; border: none; background: var(--input-bg); 
      color: var(--text); font-size: 1rem;
    }
    .calc-btn { 
      grid-column: span 2; padding: 14px; background: var(--primary); color: white; 
      border: none; border-radius: 10px; font-weight: 700; margin-top: 10px;
    }
    .calc-btn.added { background: var(--success); }

    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; min-width: 450px; }
    th { text-align: left; padding: 12px 8px; font-size: 0.75rem; color: var(--sub); border-bottom: 1px solid var(--border); }
    td { padding: 12px 8px; font-size: 0.85rem; border-bottom: 1px solid var(--border); }
    
    .link-grid { display: flex; flex-wrap: wrap; gap: 6px; }
    .btn-link { 
      background: var(--btn-link-bg); color: var(--btn-link-text); 
      padding: 8px 12px; border-radius: 8px; font-size: 0.8rem; 
      text-decoration: none; font-weight: 500;
    }
    .tax-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .tax-item { background: var(--input-bg); padding: 10px; border-radius: 10px; font-size: 0.8rem; text-align: center; }
  </style>
</head>
<body>

<div class="container">
  <div class="header-controls">
    <div class="controls-grid">
      <input id="searchInput" type="search" placeholder="Search pros, links, phones..." />
      <select id="categoryFilter">
        <option value="all">üîç All Categories</option>
        <option value="lawn">Lawn / Trees</option>
        <option value="window">Windows / Garage Doors</option>
        <option value="roof">Roof / Paint / Drywall</option>
        <option value="floor">Flooring / Carpet</option>
        <option value="special">Moving / Locksmith / Specialties</option>
        <option value="calc">Investment ROI Calculator</option>
        <option value="tool">Due Diligence Toolkit</option>
      </select>
    </div>
  </div>

  <div id="mainContent">
    <div class="card item" data-category="lawn">
      <h3>Lawn / Trees <span class="tag">Top Picks</span></h3>
      <div class="info-list">
        <div class="info-item">
          <span class="info-label">Lawn Maintenance (Mowing)</span>
          <div class="info-content">Gary <a href="tel:7044581850" class="phone-link">üìû 704-458-1850</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Aeration</span>
          <div class="info-content">
            <a href="https://www.greenyardaeration.com">Green Yard</a> or 
            Rod <a href="tel:7044880814" class="phone-link">üìû 704-488-0814</a> or 
            Jose <a href="tel:7044974327" class="phone-link">üìû 704-497-4327</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Exterior Landscape</span>
          <div class="info-content"><a href="http://www.MrOutdoorLiving.com">Mr. Outdoor Living</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Pine Needles</span>
          <div class="info-content"><a href="https://www.jjpineneedles.com">JJ Pine Needles</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Tree Removal</span>
          <div class="info-content"><a href="tel:9803224589" class="phone-link">üìû 980-322-4589‚Ä¨</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Stump Removal</span>
          <div class="info-content"><a href="https://cornerstonestumpremoval.com">Cornerstone</a></div>
        </div>
      </div>
    </div>

    <div class="card item" data-category="window">
      <h3>Windows / Garage Doors</h3>
      <div class="info-list">
        <div class="info-item">
          <span class="info-label">Window & Glass Repair</span>
          <div class="info-content">
            <a href="https://glassdoctor.com">Glass Doctor</a> | 
            <a href="https://dukevinylwindows.com">Duke Windows</a> <a href="tel:9803550756" class="phone-link">üìû 980-355-0756</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Garage Doors</span>
          <div class="info-content"><a href="https://bggaragedoors.com">B&G Garage Door</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">General Glass</span>
          <div class="info-content"><a href="https://www.binswangerglass.com/">Binswanger Glass</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Garage Door / Spring Replacement</span>
          <div class="info-content">
            <a href="tel:6172299263" class="phone-link">üìû 617-229-9263</a> | 
            <a href="https://quickfixgaragedoorservice.com">QuickFix</a> | 
            <a href="https://www.tiptopgaragedoors.com">TipTop</a>
          </div>
        </div>
      </div>
    </div>

    <div class="card item" data-category="roof">
      <h3>Roof / Paint / Walls</h3>
      <div class="info-list">
        <div class="info-item">
          <span class="info-label">Popcorn Ceiling Removal</span>
          <div class="info-content"><a href="https://www.artisttouchdrywall.com/">Artist Touch Drywall</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Painting</span>
          <div class="info-content">
            JCP <a href="tel:3365779960" class="phone-link">üìû 336-577-9960</a> | 
            Dennis <a href="tel:9807223681" class="phone-link">üìû 980-722-3681</a> | 
            Christian <a href="tel:7042322668" class="phone-link">üìû 704-232-2668</a> | 
            Molina <a href="tel:9723656178" class="phone-link">üìû 972-365-6178</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Roof Repair</span>
          <div class="info-content">
            Darryl <a href="tel:7048373967" class="phone-link">üìû 704-837-3967</a> | 
            Tony <a href="tel:9803294410" class="phone-link">üìû 980-329-4410</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">New Roof</span>
          <div class="info-content">
            <a href="https://www.newroofclt.com">New Roof</a> | 
            <a href="https://charlotteaceroofing.com/">ACE Roofing</a>
          </div>
        </div>
      </div>
    </div>

    <div class="card item" data-category="floor">
      <h3>Flooring / Carpet</h3>
      <div class="info-list">
        <div class="info-item">
          <span class="info-label">Installation</span>
          <div class="info-content">
            William <a href="tel:8018317690" class="phone-link">üìû 801-831-7690</a> | 
            Robert <a href="tel:7042888713" class="phone-link">üìû 704-288-8713</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Cleaning</span>
          <div class="info-content">
            ABC Care <a href="tel:7042015743" class="phone-link">üìû 704-201-5743</a> | 
            Luis <a href="tel:7047791322" class="phone-link">üìû 704-779-1322</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Additional Notes</span>
          <div class="info-content">
            Robert: robertwaynehicks@yahoo.com | 
            <a href="https://www.reoflooringsolutions.com">R.E.O. Solutions</a>
          </div>
        </div>
      </div>
    </div>

    <div class="card item" data-category="special">
      <h3>Moving / Locksmith / Specialties</h3>
      <div class="info-list">
        <div class="info-item">
          <span class="info-label">Moving Services</span>
          <div class="info-content">
            <a href="https://ballantynemoving.com">Ballantyne</a> | 
            <a href="https://helpinghandscharlottenc.com">Helping Hands</a> | 
            <a href="https://www.nbmoving.com">New Beginnings</a>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Moisture Analysis</span>
          <div class="info-content">Morgan <a href="tel:9807227412" class="phone-link">üìû 980-722-7412</a></div>
        </div>
        <div class="info-item">
          <span class="info-label">Emergency Locksmith</span>
          <div class="info-content">Carissa <a href="tel:9802925625" class="phone-link">üìû 980-292-5625</a></div>
        </div>
      </div>
    </div>

    <div class="item" data-category="calc">
      <div class="card">
        <h3>Investment ROI Calculator</h3>
        <div class="calc-form">
          <div class="calc-group full"><label>Property Name</label><input type="text" id="propName" placeholder="Ballantyne Condo" oninput="handleNameInput()"></div>
          <div class="calc-group"><label>Price ($)</label><input type="number" id="housePrice" value="500000" oninput="autoUpdateTax()"></div>
          <div class="calc-group"><label>Downpayment ($)</label><input type="number" id="downpayment" value="100000"></div>
          <div class="calc-group"><label>Rate (%)</label><input type="number" id="mortgageRate" value="7.2" step="0.01"></div>
          <div class="calc-group"><label>Annual Tax ($)</label><input type="number" id="annualTax" value="4500"></div>
          <div class="calc-group"><label>Annual Ins ($)</label><input type="number" id="annualIns" value="1200"></div>
          <div class="calc-group"><label>Monthly HOA ($)</label><input type="number" id="monthlyHOA" value="50"></div>
          <div class="calc-group"><label>Est. Monthly Rent ($)</label><input type="number" id="expectedRent" value="3200"></div>
          <div class="calc-group"><label>Opp. Cost (%)</label><input type="number" id="tbillRate" value="5.2"></div>
          <button class="calc-btn" id="addBtn" onclick="addProperty()">Ôºã Add Property Analysis</button>
        </div>
        <div class="tax-grid" style="margin-top:15px">
          <div class="tax-item" onclick="applyTaxRate(0.0095, 'Meck')"><b>Meck</b>0.95%</div>
          <div class="tax-item" onclick="applyTaxRate(0.0065, 'Union')"><b>Union</b>0.65%</div>
        </div>
      </div>
      
      <div id="chartArea" class="card" style="display:none">
        <canvas id="expenseChart"></canvas>
      </div>

      <div class="card" style="padding:10px">
        <div class="table-container">
          <table id="propertyList">
            <thead>
              <tr>
                <th onclick="sortTable('name')">Name</th>
                <th onclick="sortTable('totalOut')">Monthly Exp</th>
                <th onclick="sortTable('beRent')">Break-even</th>
                <th>ROI</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card item" data-category="tool">
      <h3>Due Diligence Toolkit</h3>
      <div class="link-grid">
        <a href="https://portal-nc.tylertech.cloud/Portal/" class="btn-link">NC Courts</a>
        <a href="https://mecksheriffweb.mecklenburgcountync.gov" class="btn-link">Arrest Records</a>
        <a href="https://property.spatialest.com/nc/mecklenburg#/" class="btn-link">Meck Deeds</a>
        <a href="https://www.fastpeoplesearch.com" class="btn-link">FastPeopleSearch</a>
        <a href="https://www.mysmartmove.com/SmartMove/login/landlord_new_application.page" class="btn-link">SmartMove</a>
        <a href="https://tenantbackgroundsearch.com" class="btn-link">Tenant Background</a>
        <a href="https://vt.ncsbe.gov/RegLkup" class="btn-link">NC Voter Lookup</a>
        <a href="https://voterrecords.com/" class="btn-link">US Voter Records</a>
        <a href="https://www.unionconcrod.org/" class="btn-link">Union Deed</a>
        <a href="https://property.spatialest.com/nc/union#/" class="btn-link">Union Address Search</a>
      </div>
    </div>
  </div>
</div>

<script>
// Logic preserved from original
let properties = JSON.parse(localStorage.getItem('nc_invest_props_pro_v3') || '[]');
let expenseChart = null;
let lastAddedName = "";

function handleNameInput() {
  const btn = document.getElementById('addBtn');
  const currentName = document.getElementById('propName').value.trim();
  if (currentName !== lastAddedName && currentName !== "") {
    btn.disabled = false;
    btn.innerText = "Ôºã Add Property Analysis";
    btn.classList.remove('added');
  }
}

function applyTaxRate(rate, county) {
  const price = +document.getElementById('housePrice').value;
  document.getElementById('annualTax').value = Math.round(price * rate);
  document.getElementById('propName').value = county + " Property";
  handleNameInput();
}

function calculateROI(p) {
  const loan = p.housePrice - p.downpayment;
  const r = p.mortgageRate / 100 / 12;
  const n = 360;
  const monthlyPI = (loan > 0 && r > 0) ? loan * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1) : 0;
  const monthlyTaxIns = (p.annualTax + p.annualIns) / 12;
  const maintenance = (p.housePrice * 0.008) / 12;
  const totalOut = monthlyPI + monthlyTaxIns + maintenance + p.monthlyHOA;
  const oppCost = p.downpayment * (p.tbillRate / 100) / 12;
  const beRent = totalOut + oppCost;
  const netCashFlow = (p.expectedRent - totalOut) * 12;
  const cocROI = p.downpayment > 0 ? (netCashFlow / p.downpayment * 100).toFixed(2) : "0";
  return { ...p, monthlyPI, monthlyTaxIns, maintenance, totalOut, oppCost, beRent, cocROI };
}

function addProperty() {
  const name = document.getElementById('propName').value.trim();
  if (!name) return alert("Please enter a name");
  const p = {
    id: Date.now(), name,
    housePrice: +document.getElementById('housePrice').value,
    downpayment: +document.getElementById('downpayment').value,
    mortgageRate: +document.getElementById('mortgageRate').value,
    annualTax: +document.getElementById('annualTax').value,
    annualIns: +document.getElementById('annualIns').value,
    monthlyHOA: +document.getElementById('monthlyHOA').value,
    expectedRent: +document.getElementById('expectedRent').value,
    tbillRate: +document.getElementById('tbillRate').value
  };
  properties.push(p);
  lastAddedName = name;
  saveAndRender();
  showChart(p.id);
  const btn = document.getElementById('addBtn');
  btn.innerText = "‚úì Added";
  btn.classList.add('added');
  btn.disabled = true;
}

function deleteProp(id) {
  properties = properties.filter(x => x.id !== id);
  saveAndRender();
  document.getElementById('chartArea').style.display = 'none';
}

function saveAndRender() {
  localStorage.setItem('nc_invest_props_pro_v3', JSON.stringify(properties));
  const body = document.getElementById('tableBody');
  body.innerHTML = '';
  properties.forEach(p => {
    const c = calculateROI(p);
    const tr = document.createElement('tr');
    tr.onclick = () => showChart(p.id);
    tr.innerHTML = `
      <td><b>${c.name}</b></td>
      <td>$${Math.round(c.totalOut)}</td>
      <td style="color:var(--primary); font-weight:700">$${Math.round(c.beRent)}</td>
      <td>${c.cocROI}%</td>
      <td><span style="color:red" onclick="event.stopPropagation(); deleteProp(${p.id})">Delete</span></td>
    `;
    body.appendChild(tr);
  });
}

function showChart(id) {
  const p = properties.find(x => x.id === id);
  const c = calculateROI(p);
  document.getElementById('chartArea').style.display = 'block';
  const ctx = document.getElementById('expenseChart').getContext('2d');
  if(expenseChart) expenseChart.destroy();
  expenseChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['P&I', 'Tax/Ins', 'HOA', 'Maint.', 'Opp. Cost'],
      datasets: [{ data: [c.monthlyPI, c.monthlyTaxIns, c.monthlyHOA, c.maintenance, c.oppCost], backgroundColor: ['#007aff', '#ff9500', '#ff3b30', '#34c759', '#8e8e93'] }]
    }
  });
}

function sortTable(key) {
  properties.sort((a,b) => calculateROI(a)[key] > calculateROI(b)[key] ? 1 : -1);
  saveAndRender();
}

document.getElementById('searchInput').addEventListener('input', (e) => {
  const term = e.target.value.toLowerCase();
  document.querySelectorAll('.item').forEach(card => {
    card.style.display = card.innerText.toLowerCase().includes(term) ? 'block' : 'none';
  });
});

document.getElementById('categoryFilter').addEventListener('change', (e) => {
  const cat = e.target.value;
  document.querySelectorAll('.item').forEach(card => {
    card.style.display = (cat === 'all' || card.dataset.category === cat) ? 'block' : 'none';
  });
  if (cat !== 'all') {
    const firstVisible = document.querySelector(`.item[data-category="${cat}"]`);
    if(firstVisible) firstVisible.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
});

window.onload = saveAndRender;
</script>

</body>
</html>
